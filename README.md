# smart-env

## Описание
Утилита для проверки переменных окружения с помощью json-schema

### Мотивация

> Store config in the environment

Одним из [12 факторов методологии](https://en.wikipedia.org/wiki/Twelve-Factor_App_methodology) является конфигурация, 
и он гласит, что переменные конфигурации лучше брать из окружения, но все переменные окружения это строки и каждый раз 
надо выполнять одни и те же  действия: 

- проверить значение переменной (задано или нет значение)
- преобразовать в нужный тип
- проверить на регулярное выражение, диапазон в общем на некий формат
- добавить в документацию описание переменных и для чего они нужны (для DevOps и/или других разработчиков)

> Каждый раз одно и тоже, но куда же это гоже

Суть идеи в том что есть утилита которая берет на себя автоматизацию вышеперечисленных действий. Утилита при запуске 
ищет файл конфигурации, далее идет проверка. В результате успешной проверки получаем json файл с уже конвертированными 
и проверенными значениями.

## Возможности
 - загрузка файла конфигурации в форматах: yaml, yml
 - загрузка переменных окружения с файла
 - конвертация из строки, проверка на ограничения
 - сохранение результатов в файл
 - генерация конфигурационного файла (команда init)

### Конфигурационный файл

Файл конфигурации задается опцией --dir, -d в качестве значения относительный или абсолютный путь до папки в которой есть файл с именем smart-env.[format]

Формат может быть yaml, yml

Если опция dir не задана то по умолчанию поиск файла будет выполнен в текущей директории

Пример конфигурационного файла
```yaml
version: 1.0

variables:
  PORT:
    castTo: number
    constraints:
      minimum: 3000
      maximum: 5000
```

- *version* - версия API на данный момент 1.0
- *variables* - объект, в качестве ключа имя переменной окружения
    - *castTo* - в какой тип данных надо преобразовать строковое значение переменной окружения
    - *[constraints]* - ограничения, условия (если условий нет то ключ можно не указывать), которым должно соотвествовать преобразованное значение переменной окружения, 
    поддерживается синтаксис [json-schema](https://json-schema.org/) draft-7

#### castTo
Возможные значения:
- **number**, **int** - целые числа
- **string** - строковое значение
- **float** - число с плавающей точкой
- **bool**, **boolean** - логическое значение

## Зависимости
 - ```go get -u github.com/urfave/cli```
 - ```go get -u gopkg.in/yaml.v2```
 - ```go get -u github.com/xeipuuv/gojsonschema```
 - ```go get -u github.com/joho/godotenv```
 
## Запуск через nodemon

Установка nodemon

```sh
npm install -g nodemon
```
Запуск

```sh
nodemon
```

Установка и запуск одной коммандой 

```sh
npm install -g nodemon && nodemon
```
